# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

## [2.1.0] - 2021-04-14

### Added

* Enable List and String for VirtualService Domain.
* Helper Function to create authorizationCode.appUrl from the given Domain.


## [2.0.0] - 2021-04-07

### Added

* Extended CORS configuration support by adding  `gloo.virtualservice.spec.virtualHost.cors.allowSubdomain` value.

### Breaking Changes

* Gloo OAuth2 Plugins
  * Improve error handling
  * Secure handling of Client Secret
  * Ensure Two-Factor Authentication
  * Validate Client ID
  * Refactoring

## [1.3.1] - 2021-03-08

### Added

* Added tags `env`, `service` and `version` for DataDog according to [Unified Service Tagging](https://docs.datadoghq.com/getting_started/tagging/unified_service_tagging?tab=kubernetes).

## [1.3.0] - 2021-02-19

### Breaking Changes

* Changed swagger ui routing:
  * introduced `gloo.virtualservice.spec.virtualHost.routes.swagger.enabled` to switch on swagger ui routing
  * `gloo.virtualservice.spec.virtualHost.routes.swagger.rewriteUrl` was renamed to `.Values.gloo.virtualservice.spec.virtualHost.routes.swagger.alternativePath`
  * routing from `...swagger.alternativePath` to `...swagger.path` is done by HTTP redirect now because URL rewrite does not work due to a quirk in `springfox.js` which relies on the name `swagger-ui.html`.
* Added `gloo.authConfig.spec.configs.backendPlugin.config.jwksUrl` value. This has no default but is mandatory for each service using the `backendPlugin`.
* Reworked M2M authentication:
  * Renamed `gloo.authConfig.spec.configs.m2mPlugin.config.oidcUrl` to `gloo.authConfig.spec.configs.m2mPlugin.config.amBaseUrl` to match WebEAM naming.
  * Added `gloo.authConfig.spec.configs.m2mPlugin.config.mode` which has no default but is mandatory.
  * Reworked K8S resource (`AuthConfig`) to match the API of the latest `AuthM2m` plugin.

### Added

* Added support for CORS configuration of Gloo virtual services (`gloo.virtualservice.spec.virtualHost.cors`) according to [Gloo documentation: CORS](https://docs.solo.io/gloo-edge/latest/guides/security/cors/).
* K8S Secrets conaining the oauth client secrets for OIDC (known as `webeam-oidc` secrets) can now be generated by helm as [`ExternalSecret`](https://github.com/external-secrets/kubernetes-external-secrets) referencing to AWS secrets manager secrets.
* Added HTTP to HTTPS redirect by means of Gloo (see [Gloo documentation: HTTPS Redirect](https://docs.solo.io/gloo-edge/latest/guides/traffic_management/request_processing/https_redirect/)). This is done automatically for all deployments which have either a `gloo.virtualservice.spec.virtualHost.routes.callbackUrlPath` configured or `.Values.gloo.virtualservice.spec.virtualHost.routes.swagger.enabled` set to `true`. Such deployments are treated as user interfaces (or documentation interface) where a HTTP to HTTPS redirect should be provided for user convenience. In case of `...swagger.enabled` the redirect is limited to the paths defined as `...swagger.path` and `...swagger.alternativePath`.
* Added `gloo.authConfig.spec.configs.oauth.cookie_domain` to provide a domain to be used for authentication cookies (`it_token` and `access_token`). This value is required for UI services which execute cross origin requests to other services hosted by the platform - e.g. UI and its backend are hosted as separate services.
* Extended the generated `VirtualService` K8S Resources for Gloo by `sniDomains` (see [Serving certificates for multiple virtual hosts with SNI](https://docs.solo.io/gloo-edge/latest/guides/security/tls/server_tls/#serving-certificates-for-multiple-virtual-hosts-with-sni)).

### Removed

* Completely removed configuration of `SessionCache` plugin (`gloo.authConfig.spec.configs.cachePlugin` values) because this plugin is outdated and will be replaced.

## [1.2.2] - 2021-02-02

### Changed

* Blacklisting authentication path prefix (`gloo.virtualservice.spec.virtualHost.routes.appPath` and `gloo.virtualservice.spec.virtualHost.routes.callbackUrl`). 
* Enable FDS in Gloo Upstream to dectect gRPC functions

## [1.2.1] - 2021-01-13

### Added

* Add swagger ui routes options

### Removed

* Removed Gloo Function Discovery Service url path

## [1.2.0] - 2020-12-03

### Added

* Add Support for Gloo Function Discovery Service url path

## [1.1.0] - 2020-11-17

### Added

* Add Support for Machine to Machine Gloo Plugin
* Add Support for Backend Gloo Plugin to verify Access Tokens and Cookies
* Helpers Function for Service Account Name
* Small Refactoring and Fixes

## [1.0.0] - 2020-10-29

### Added

* Enable the use of Datadog
* Enable the use of External Secrets
* Add Gloo OAuth Plugin for Authorization Flow in UI's
* Add Gloo Virtual Service as Cluster Ingress
* Enable Istio for each deployed Pod
* Fix Linter Issues
* Small Refactoring and Fixes

## [0.0.2] - 2020-10-06

### Added

* Additional deployment flag to allow disabling VirtualService deployment 

## [0.0.1] - 2020-10-02

### Added

* Initial Version
* Contains K8S Resources: Deployment, Service, Secret, ConfigMap
* Contains gloo Resources: VirtualService

[0.0.1]: https://github.com/DVPE-cloud/dvpe-helm/tree/dvpe-deployment-gloo-0.0.1/charts/dvpe-deployment-gloo
[0.0.2]: https://github.com/DVPE-cloud/dvpe-helm/tree/dvpe-deployment-gloo-0.0.2/charts/dvpe-deployment-gloo
[1.0.0]: https://github.com/DVPE-cloud/dvpe-helm/tree/dvpe-deployment-gloo-1.0.0/charts/dvpe-deployment-gloo
[1.1.0]: https://github.com/DVPE-cloud/dvpe-helm/tree/dvpe-deployment-gloo-1.1.0/charts/dvpe-deployment-gloo
[1.3.0]: https://github.com/DVPE-cloud/dvpe-helm/tree/dvpe-deployment-gloo-1.3.0/charts/dvpe-deployment-gloo
[1.3.1]: https://github.com/DVPE-cloud/dvpe-helm/tree/dvpe-deployment-gloo-1.3.1/charts/dvpe-deployment-gloo
[2.0.0]: https://github.com/DVPE-cloud/dvpe-helm/tree/dvpe-deployment-gloo-2.0.0/charts/dvpe-deployment-gloo
[2.1.0]: https://github.com/DVPE-cloud/dvpe-helm/tree/dvpe-deployment-gloo-2.1.0/charts/dvpe-deployment-gloo

